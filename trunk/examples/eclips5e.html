<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <link rel="stylesheet" type="text/css" href="styles.css" />

        <script type="text/javascript" src="../src/TinyC5-0.6.js"></script>
        <script type="text/javascript">
            function Eclip5e() {         
                var tinyC5 = new TinyC5();
                var args = { container: document.getElementById( 'tinyC5_container' ),
                    title: '[PHENOMENA] Eclip5e',
                    scale: 2
                };
                
                tinyC5.init( args );
                var tContext = tinyC5.getCanvas().getContext('2d');
                tContext.font = "bold 12px sans-serif";
                var t, st = 240, o=200, Q, W = 0, p,q =255;
                
                var u = function (x) {
                    return Math.max( 0, Math.min( q, q * x) );
                };

                var h = function (a, b) {
                   return Math.sqrt(a*a + b*b);
                }
                
                tinyC5.update = function() {
                    //t = t < o*10 ? t +=0.6 : t = 0;
                    t = st - tinyC5.getTime()/125;
                    Q = t/75;
                    W -=5;

                    p = tinyC5.pixels;
                    var index = 0, m, n, v,s2=1;
                    for( var y = 0; y < tinyC5.HEIGHT; y++ ) {
                        for( var x=0; x < tinyC5.WIDTH; x++ ) {
                            m = x/10 - 20;
                            n = y/10 - 10 ;
                            
                            v = 8/(Math.pow(Math.abs(m),2)+n*n)+Math.pow(h(Math.abs(m),n),-(t*0.1))-Math.pow(h(Math.abs(m)-(t*0.05),Math.abs(n)-(t*0.008)),-9)-Math.log(h(m,n)/9);

                            p[ index++ ] = u(v);
                            p[ index++ ] = u( v - Math.cos(Q * s2) );
                            p[ index++ ] = u( v - Math.sin(Q * s2) );
                            index++;                                                                                // Skip alpha
                        }
                    }
                    
                    tContext.fillStyle = "rgba(255, 0, 0, 255)";
                    tContext.fillText( t, 100, 100 );
                }
                
                    
                    // Get the canvas object
                    var canvas = tinyC5.getCanvas();
                    canvas.addEventListener( 'click', function(e) { 
                        console.log( t );
                    } );                   
                
                tinyC5.start();
                
            }

    
      function i()
      {
        // only for fast CPUs
        //c.style.width='100%';c.style.height=innerHeight+'px'
        
        // get p(ixels) array
        p = b.getImageData( 0, 0, o, o/2);
        //t = t < 15 ? t +=0.05 : t = 0;
        t = t < o*10 ? t +=2 : t = 0;
        Q = t/75;
        W -=5;
        /*
        if (  !(t%o) )

        {
            s += 1;
            f = 1;
        }
        else if ( o/2 < f )
        {
            f=q;

        }
        else
        {
            f += 2;
        }
        */
        //step = (t==0) ? ++step : step;
        s = s > 4 ? 1 : s;
        s2 = s;

        for( y=0; y < o/2 ; y++ )
        {
            /*
            if ( f < o/2 && f < y)
            {
              if (s==1)s2=4;
              if (s==2)s2=1;
              if (s==3)s2=2;
              if (s==4)s2=3;
            }
            */
           
          //step2 = ( y > f ) ? step2 += 1 : step;         
          for ( x=0; x < o; x++ )
          {          
            //      m = x/5 - 10;
            //      n = y/5 - 10;
            m = x/10 - 20;
            n = y/10 - 10 ;
                       
            //val = 1- 2 + 1.5 * M.s( t * 2 + ( x * x + y * y) * 0.1)*1+ M.pow( - ( ( x * x+ y* y) * 0.1 - 5 ) / 1.6 + M.s( M.atan2( y, x) * 8 + t),1.0) + (M.cos( M.atan2( y, x) * 15.0 ) * M.cos( M.atan2( y,x)- t)* M.cos(( x* x+ y*y)*0.2));
            //val = 1 - 2 + 1.5 * M.s( t * 2 + ( m * m + n * n ) * 0.1)*1+ M.pow( - ( ( m * m + n * n ) * 0.1 - 5 ) / 1.6 + M.s( M.atan2( n, m) * 8 + t ),1.0) + (M.cos( M.atan2( n, m) * 15.0 ) * M.cos( M.atan2( n,m )- t)* M.cos(( m* m+ n*n)*0.2));

            // #1 - higher t
            //val = 0.01 + ( M.s( 1.8 * hypot( m, n - t ) - M.atan2( n, m ) ) );          
            if (s2==1)
            // #2            
            v = 8/(M.pow(M.abs(m),2)+n*n)+M.pow(h(M.abs(m),n),-(t*0.1))-M.pow(h(M.abs(m)-(t*0.05),M.abs(n)-(t*0.008)),-9)-M.log(h(m,n)/9);

            if (s2==2)
            // #3
            v = M.s( m * W ) + M.s( n * W ) +M.s( W * W + m * m + n * n );

            if (s2==3)
            //v = 1/(M.pow(M.abs(m),2)+n*n)+M.pow(hypot(M.abs(m),n),-(t*0.1))-M.pow(hypot(M.abs(m)-(t*0.02),M.abs(n)-(t*0.008)),-1)+M.log(hypot(m,n)/2);
            v = M.s( m + n * Q ) - M.c( n + m * Q );

            if (s2==4)
            // 4
            //val = M.s( t * m * n ) + M.s( n ) * M.cos( t ) * 1;          
            v = M.s( Q * m * n ) + M.s( n ) * M.c( Q )/1000;// * 0.001;
            
                       
            z = 4 * ( y * o + x );

            /*
            p.data[ z + 0 ] = M.max( 0, M.min(q, q * v) ); //255 * val;  // Qed
            p.data[ z + 1 ] = M.max( 0, M.min(q, q * ( v - M.c(Q * s2) ) ) );  // Gree           
            p.data[ z + 2 ] = M.max( 0, M.min(q, q * ( v - M.s(Q * s2) ) ) );  // Blue
            */
            p.data[ z + 0 ] = u(v); //255 * val;  // Qed
            p.data[ z + 1 ] = u( v - M.c(Q * s2) );  // Gree           
            p.data[ z + 2 ] = u( v - M.s(Q * s2) );  // Blue

            p.data[ z + 3 ] = q;
          }
        }
      
        //b.putImageData( p, 0, 0 );
        b.putImageData(p,0,0);
 
        // Draw fullscreen    
        g.drawImage( a, 0, 0, k, l);

        function u(x)
        {
            return M.max( 0, M.min( q, q * x) );
        }

        // M.sqrt(a*a+b*b)
        function h(a, b) 
        {
           return M.sqrt(a*a + b*b);
        }
        
      }
        </script>
    </head>
    <body onload="new Eclip5e();">
        <div id="container">
            <div id="tinyC5_container">                
            </div>
        </div>
        <!--
        <div id="footer">
            Plane Deformation. Original code and texture by <a href="http://www.luis.net/">luis.net</a> | Created with <a href="http://www.dbfinteractive.com/forum/index.php?topic=5397.0">TinyC5</a>
        </div>#
        -->
        <script>
                       /*     
                // Init main screen
                M = Math;
                M.c = M.cos;
                M.s = M.sin;
                d = document;      
                w = this;
                c = d.getElementById('c');   
                g = c.getContext('2d');

                k = c.width = w.innerWidth;
                l = c.height = w.innerHeight;
                W = 0;

                // Create hidden 'back'buffer in original size
                a = d.createElement('canvas');      
                a.width = o = 200;
                a.height= o/2;
                a.style.display = 'none';
                b = a.getContext('2d');
                d.body.appendChild( a );

                t=0;          // param
                s=1;          // Step count #1      
                f = q=255;        // Max color value
                     //f = Fader counter

                setInterval( i, 16 );
                */

        </script>
    </body>
</html>